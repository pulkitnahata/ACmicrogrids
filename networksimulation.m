% new filter parameters 

Is=[0 omega_o; -omega_o 0];
Vref=[0.9;1.15;1.1;0.9];

K11=kron(L_t+eye(2),eye(2));
K22=kron(L_t,-Is)+kron(R_t-2*eye(2),eye(2));
K33=eye(2*n);

alpha=-(kron(L_t^-1,eye(2))^-1)+(kron(L_t^-1,eye(2))^-1)*K11;
beta=kron(eye(n),Is)+kron(-L_t^-1*R_t,eye(2))+(kron(L_t,eye(2))^-1)*K22;
gamma=(kron(L_t^-1,eye(2))^-1)*K33;

X=[kron(eye(N),Is)+kron(-C_t^(-1)*Y_L, eye(2)),[kron(C_t(1:n,1:n)^(-1),eye(2));zeros(2*m,2*n)],zeros(2*N,2*n),kron(-C_t^(-1)*B,eye(2)); 
    [alpha,zeros(2*n,2*m)],beta,gamma,zeros(2*n,2*M);
    [-eye(2*n),zeros(2*n,2*m)],zeros(2*n),zeros(2*n),zeros(2*n,2*M); kron(L^(-1)*B',eye(2)),zeros(2*M,2*n),zeros(2*M,2*n),kron(-L^(-1)*R, eye(2))+kron(eye(M),Is)];
I=[kron(-C_t^(-1),eye(2))*kron(I_l,ones(2,1));zeros(2*n,1);Vref;zeros(2*M,1)];

net_par.I       = I;
net_par.X       = X;

inval=[-31.6389674424649,24.2666654376787,-31.6343035940168,24.2828254649379,-31.6194404853757,24.2631890464089,-31.6338304124232,24.2599890418747,-31.6290891576670,24.2706001087494,-31.6303627522577,24.2663962789092,0.172139439890059,-0.118073999210443,0.239957874304279,-0.164930837290050,32.8675564925601,-22.8911938643588,33.0705801898635,-23.1463016977231,-0.768922377095688,-0.710194114511797,2.68190059968466,3.04168923047268,-1.73682540334609,-2.14940258814270,1.79106434687457,1.65409228458782,-1.00764767516035,-1.03648915794946,0.342332698462599,0.350781596363472,0.500409988309709,0.143805918981870];
dt=0.001;
t_sim=10;
tr=0:dt:t_sim;
%inval=[47.5853   48.6172   40.1904   50.7604   48.0245   50.3132   63.1395  -27.5076 -278.2373  269.5002  -58.4532   60.1488    1.8274    1.2196    3.0172    2.0386    0.5033    0.9866  -20.6509  105.6552   53.5518  176.1727   27.2855  -34.1892  -28.6063]';

[t,y]=ode45(@(t,y) ACmicro(t,y,net_par), tr, inval);


